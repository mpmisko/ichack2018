#!/usr/bin/nodejs
/* jshint node:true, devel:true */

/*
 * @author Xunnamius
 *
 * @requires CompileStrategy
 */

"use strict";

const CompileStrategy = require('./CompileStrategy');

/**
 * Adapter for (gulpification of) the shopfy-liquid plugin.
 */
class ShopifyLiquidCompileStrategy extends CompileStrategy
{
    /**
     * Constructor
     *
     * @param {Liquid} engine An instance of the shopify-liquid engine
     */
    constructor(engine)
    {
        super();
        this._engine = engine;
    }

    /**
     * The compile method accepts raw text (a string) as an input and outputs
     * that text compiled with the shopify-liquid engine.
     *
     * @param {String} raw     The text to compile
     * @param {Object} context Any local variables that should be passed into
     * the compilation engine
     *
     * @returns {Promise} A promise that resolves into the compiled text (String)
     */
    compile(raw, context)
    {
        return this._engine.parseAndRender(raw, context);
    }

    /**
     * The getActiveEngine method will return the default internal Liquid
     * compiler "engine" instance.
     *
     * @returns {Object} the default internal Liquid compiler "engine" instance
     */
    getActiveEngine()
    {
        return this._engine;
    }
}

module.exports = ShopifyLiquidCompileStrategy;
